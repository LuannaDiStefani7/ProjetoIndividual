<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <link rel="stylesheet" href="CSS/menu.css">
    <link rel="stylesheet" href="CSS/index.css">
    <link rel="icon" href="IMG/icon-hollow.png">
    <title>HOME</title>
</head>

<body onload="obterDadosGrafico()">

    <!-- Início - Menu -->

    <nav>

        <a href="../index.html"><img src="IMG/logo.png"></a>

        <div>
            <a href="HTML/pagina_resenha.html"> Resenhas </a>
            <button id="botao_log"> <a href="HTML/login.html"> Login </a> </button>
            <button id="botao_cad"> <a href="HTML/cadastro.html"> Cadastro</a></button>

        </div>

    </nav>

    <!-- Final - menu -->

    <!-- Início - Banner 1 -->

    <div id="banner">

        <img id="titulo" src="IMG/titulo_hollow_knight.png" alt="Imagem escrita - Hollow Knight">

    </div>


    <!-- Final - Banner 1 -->

    <!-- Início - introdução-->

    <div id="introducao">

        <img src="IMG/Mapa 2.jpeg" alt="Mapa - Hollow Knight">

        <div id="text-intro">
            <h2>INTRODUÇÃO: </h2>

            <p>Forje <span> seu caminho </span> em Hollow Knight!
                Uma <span id="um">aventura</span> de ação <span id="dois">épica</span> em um vasto reino arruinado de
                <span id="tres">insetos e heróis</span>.
                <span id="quatro">Explore </span> cavernas serpenteantes,
                <span id="cinco">lute</span> contra criaturas malignas e <span id="seis">alie-se</span> a insetos
                bizarros num <span id="sete"> estilo clássico</span> 2D desenhado à mão.
            </p>

            <video src="IMG/gif-besouro.mp4" type="video/mp4" autoplay muted loop></video>

        </div>

    </div>

    <!-- Final - Introdução -->


    <!-- Início - Sobre os desenvolvedores -->


    <div id="text-desenvolvedores">

        <img id="titulo" src="IMG/sobre os desenvolvedores.png" alt="Sobre os desenvolvedores">

        <div id="conteudo">

            <div id="text-intro-dev">

                <img id="logo_team" src="IMG/team-cherry-logo.jpg">

                <p>
                    "Team Cherry é uma pequena equipe de jogos indie em Adelaide, S Australia.
                    Nossa missão é construir mundos loucos e emocionantes para você explorar e conquistar.""
                </p>

                <div id="link-team-cherry">
                    <a href="https://www.facebook.com/teamcherrygames"><img src="IMG/icon-facebook.png"> </a>
                    <a href="https://twitter.com/TeamCherryGames"><img src="IMG/icon-twitter.png"></a>
                    <a href="https://www.youtube.com/user/teamcherrygames"><img src="IMG/icon-youtube.png"></a>
                    <a href="https://www.teamcherry.com.au/"><img id="icon-team" src="IMG/team-cherry-logo.jpg"></a>
                </div>

            </div>

            <div id="text-dev-hollow">

                <p>
                    Hollow Knight é o primeiro lançamento do Team Cherry.
                    Sua equipe inicialmente se formou em torno de game jams, mas eles se uniram por causa de seu amor
                    por Zelda 2 . Embora todos tenham trabalhado em jogos no passado,
                    Hollow Knight é o ponto culminante das coisas que eles amam nos jogos.
                    Em 2017, eles começaram a trabalhar na sequência do jogo original: Hollow Knight: Silksong .

                </p>

                <img id="img-zote" src="IMG/zote.png">

            </div>

        </div>

    </div>


    <!-- Final - Sobre os desenvolvedores -->

    <!-- Início - Conquistas -->

    <div id="conquistas_div">

        <img src="IMG/conquistas.png" id="titulo_conquista">

        <div id="mosaico">

            <div id="conquista_1">

                <img src="IMG/Afortunado.png">
                <p> Afortunado</p>
                <p> Adquira seu primeiro Amuleto</p>

            </div>

            <div id="conquista_2">

                <img src="IMG/Falsidade.png">
                <p>Falsidade</p>
                <p>Derrote o Falso Cavaleiro</p>

            </div>
            <div id="conquista_3">

                <img src="IMG/Teste_de_Resolucao.png">
                <p>Teste de Resolução </p>
                <p>Derrote Hornet no Caminho Verde</p>

            </div>
            <div id="conquista_4">

                <img src="IMG/Conexao.png">
                <p>Conexão</p>
                <p>Abra metade das Estações de Besouro de Hallownest</p>

            </div>
            <div id="conquista_5">

                <img src="IMG/Protegido.png">
                <p>Protegido</p>
                <p>Adquira 4 Fragmentos de Máscara</p>

            </div>

        </div>

        
        <div id="grafico">

            <canvas id="myChart"></canvas>

        </div>
        
    </div>

    <!-- Final - Conquistas -->

</body>

</html>

<script>

    function obterDadosGrafico() {

        fetch(`/medidas/ultimas`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            labels: labels,
            datasets: [{
                axis: 'y',
                label: 'dados de conquistas',
                data: [],
                fill: false,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(255, 205, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(201, 203, 207, 0.2)'
                ],
                borderColor: [
                    'rgb(255, 99, 132)',
                    'rgb(255, 159, 64)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(54, 162, 235)',
                    'rgb(153, 102, 255)',
                    'rgb(201, 203, 207)'
                ],
                borderWidth: 1
            }]
        };


        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.nomeConquista);
            dados.datasets[0].data.push(registro.porcent);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'bar',
            data: dados,
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`myChart`),
            config
        );

        // setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
    }


    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas,

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models


</script>